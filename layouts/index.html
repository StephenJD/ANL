{{ define "main" }}
{{ $showDebug := false }}

{{ $homeBundle := site.GetPage site.Params.home }}

{{ if not $homeBundle }}
  <div style="border:3px solid red; padding:1rem; text-align:center;">
    ⚠️ DEBUG: No home bundle found.<br>
    site.Params.home = {{ site.Params.home }}
  </div>
{{ end }}

{{ if $showDebug }}
<div style="border: 5px solid red; padding: 1rem; text-align: center;">
  HOME LAYOUT ACTIVE \layouts\index.html
  Revised 33
</div>

<pre id="theme-debug" style="border:1px solid blue; padding:1rem; margin-top:1rem;">
DEBUG: waiting for theme info...
</pre>
{{ end }}

<div class="home-hero" style="
    position: relative;
    background-image: url('{{ $homeBundle.Params.hero_background }}');
    background-size: cover;
    background-position: center;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    justify-content: flex-start;
    align-items: center;
    padding: 2rem;
">

  <!-- Dark-mode overlay -->
  <div class="hero-overlay"></div>
  
  <!-- Content on top -->
  <div style="position: relative; z-index: 1; width: 100%;">
    <!-- Logo container: flex-centered -->
    <div style="display:flex; justify-content:center; width:100%; margin-bottom:1rem;">
      {{ $logo := "" }}
      {{ with $homeBundle.Params.hero_logo }}
        {{ $res := $homeBundle.Resources.GetMatch . }}
        {{ if $res }}
          {{ $logo = $res.RelPermalink }}
        {{ end }}
      {{ end }}

      {{ if $logo }}
        <img src="{{ $logo }}" alt="ANL Logo" style="max-width:300px;">
      {{ end }}
    </div>
    
    <!-- Home sections -->
    {{ $homeSections := sort ($homeBundle.Resources.Match "*.md") "File.BaseFileName" }}
    {{ range $homeSections }}
      <section id="{{ .File.BaseFileName }}" style="padding:2rem; margin:1rem 0; text-align:center; width:100%;">
        <h2>{{ .Params.title }}</h2>
        {{ .Content | safeHTML }}
      </section>
    {{ end }}
  </div>
</div>

<style>
.home-hero .hero-overlay {
  position: absolute;
  top:0; left:0; right:0; bottom:0;
  z-index: 0;  /* behind content */
  pointer-events: none;
  background-color: transparent; /* light mode = no dimming */
  transition: background-color 0.3s ease;
}

/* Dimming only in dark mode */
body.dark .home-hero .hero-overlay {
  background-color: rgba(0,0,0,0.5);
}
</style>

{{ if $showDebug }}
<script>
function updateThemeDebug() {
  const body = document.body;
  const dbg = document.getElementById("theme-debug");
  if (dbg) {
    dbg.innerText = "DEBUG: <body> classList = " + body.classList.value;
  }
}

// Run immediately and observe for class changes
updateThemeDebug();
new MutationObserver(updateThemeDebug).observe(document.body, { attributes: true, attributeFilter: ["class"] });
</script>
{{ end }}

{{ end }}
