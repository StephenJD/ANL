{{/* layouts/forms/single.html */}}
{{ define "main" }}
  {{ $current_page := . }}
  
  {{ $rawAccess := .Params.access | default "public" }}
  {{ $access := slice }}
  
  {{ if $rawAccess }}
    {{ range (split (printf "%v" $rawAccess) ",") }}
      {{ $clean := trim . " " }}
      {{ if $clean }}
        {{ $access = $access | append (lower $clean) }}
      {{ end }}
    {{ end }}
  {{ else }}
    {{ $access = slice "public" }}
  {{ end }}  
  
  <link rel="stylesheet" href="{{ "css/forms.css" | relURL }}">
  
  
  <div class="debug-message">
  DEBUG: forms/single.html is running
  | Type={{ $current_page.Type }}
  | Section={{ $current_page.Section }}
  | Params.access={{ $current_page.Params.access | default "not set" }}
  | Page={{ $current_page }}
</div>

  {{/* <div> Opened in this parial */}}
  {{ partial "anl_page_chrome.html" $current_page }}
  
  <div class="form-container">
    <h1>{{ .Title }}</h1>
    {{ partial "form_request.html" . }}
    {{ partial "page_access_message.html" . }}

    <form name="{{ .Title | urlize }}" autocomplete="off" class="verified-form" data-netlify="true" netlify>
      {{ if not (in $access "public") }}
        <div class="gated_page_placeholder">
	     <div class="page_access_message">Loading pageâ€¦</div>
        </div>
      {{ else }}
        {{ .Content }}
      {{ end }}
	{{ partial "form_submit_button.html" . }}
    </form>
  </div>
</div>

<script>
    const pagePath = "{{ .File.Path }}"
</script>

<script type="module" src="{{ "js/form_access_controller.js" | relURL }}" defer></script>
<script type="module" src="{{ "js/form-init.js" | relURL }}" defer></script>

{{ end }}
