<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Final Form Submission</title>
</head>
<body>
  <p id="status">Submitting...</p>
  <script>
    (async () => {
      const status = document.getElementById('status');
      const token = new URLSearchParams(window.location.search).get('token');

      try {
        const resp = await fetch("/.netlify/functions/finalSubmit", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ token })
        });
        if (!resp.ok) throw new Error("finalSubmit " + resp.status);
        const data = await resp.json();
        status.textContent = data.success
          ? "✅ Your form has been successfully submitted!"
          : "❌ Submission failed. Please try again.";
      } catch (err) {
        console.error(err);
        status.textContent = "Error submitting form.";
      }
    })();
  </script>
</body>
</html>
